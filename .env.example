# ============================================
# Breeze RMM - Environment Configuration
# ============================================
# Copy this file to .env and update values for your environment
# NEVER commit the .env file to version control

# --------------------------------------------
# Database Configuration
# --------------------------------------------
POSTGRES_USER=breeze
POSTGRES_PASSWORD=breeze_secure_password_change_me
POSTGRES_DB=breeze
POSTGRES_PORT=5432

# Full database connection URL (used by API)
DATABASE_URL=postgresql://breeze:breeze_secure_password_change_me@localhost:5432/breeze

# --------------------------------------------
# Redis Configuration (BullMQ Job Queue)
# --------------------------------------------
REDIS_URL=redis://localhost:6379
REDIS_PORT=6379

# --------------------------------------------
# Authentication & Security
# --------------------------------------------
# CRITICAL: Generate strong secrets for production
# Use: openssl rand -base64 64
JWT_SECRET=your-super-secret-jwt-key-change-in-production-must-be-at-least-32-chars
JWT_EXPIRES_IN=15m
REFRESH_TOKEN_EXPIRES_IN=7d

# Agent enrollment secret (for device registration)
# Use: openssl rand -hex 32
AGENT_ENROLLMENT_SECRET=your-enrollment-secret-change-in-production

# --------------------------------------------
# Server Configuration
# --------------------------------------------
NODE_ENV=production
API_PORT=3001
WEB_PORT=4321

# Public URL for the API (used by web frontend)
PUBLIC_API_URL=http://localhost:3001
CORS_ALLOWED_ORIGINS=http://localhost:4321,http://localhost:3000

# --------------------------------------------
# Object Storage (S3/R2/MinIO)
# --------------------------------------------
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY=minioadmin
S3_SECRET_KEY=minioadmin
S3_BUCKET=breeze
S3_REGION=us-east-1

# MinIO Console (when using local MinIO)
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001

# --------------------------------------------
# Email Configuration
# --------------------------------------------
# Required for password reset and notifications.
# EMAIL_PROVIDER:
#   - auto (default): use Resend, then SMTP, then Mailgun when configured
#   - resend: require RESEND_API_KEY + EMAIL_FROM
#   - smtp: require SMTP_HOST + SMTP_FROM (EMAIL_FROM can be used as fallback)
#   - mailgun: require MAILGUN_API_KEY + MAILGUN_DOMAIN (MAILGUN_FROM or EMAIL_FROM)
EMAIL_PROVIDER=auto
RESEND_API_KEY=
EMAIL_FROM=noreply@breeze.local
SMTP_HOST=
SMTP_PORT=587
SMTP_USER=
SMTP_PASS=
SMTP_FROM=noreply@breeze.local
SMTP_SECURE=false
MAILGUN_API_KEY=
MAILGUN_DOMAIN=
MAILGUN_BASE_URL=https://api.mailgun.net
MAILGUN_FROM=noreply@breeze.local

# --------------------------------------------
# Twilio Configuration (SMS MFA + SMS Alert Notifications)
# --------------------------------------------
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_VERIFY_SERVICE_SID=
TWILIO_MESSAGING_SERVICE_SID=
TWILIO_PHONE_NUMBER=

# --------------------------------------------
# AI Brain (BYOK - Bring Your Own Key)
# --------------------------------------------
# Optional: Provide your Anthropic API key to enable the AI assistant
ANTHROPIC_API_KEY=

# --------------------------------------------
# Encryption & Security Keys
# --------------------------------------------
# CRITICAL: Generate unique keys for production
# Use: openssl rand -hex 32
APP_ENCRYPTION_KEY=generate-a-random-hex-string-for-production
MFA_ENCRYPTION_KEY=generate-a-random-hex-string-for-production
ENROLLMENT_KEY_PEPPER=generate-a-random-hex-string-for-production
MFA_RECOVERY_CODE_PEPPER=generate-a-random-hex-string-for-production

# --------------------------------------------
# CORS Configuration
# --------------------------------------------
# Comma-separated list of allowed origins for CORS.
# In production, default localhost origins are excluded unless CORS_INCLUDE_DEFAULT_ORIGINS=true.
CORS_ALLOWED_ORIGINS=https://app.yourdomain.com
# CORS_INCLUDE_DEFAULT_ORIGINS=true  # Uncomment to re-include localhost origins in production

# --------------------------------------------
# Portal State Backend
# --------------------------------------------
# Set to 'redis' for production deployments. Defaults to in-memory for development.
# In production (NODE_ENV=production), Redis is used automatically.
# PORTAL_STATE_BACKEND=redis

# --------------------------------------------
# MCP Server Configuration
# --------------------------------------------
# Rate limits for MCP API endpoints (per API key, per minute)
# MCP_SSE_RATE_LIMIT_PER_MINUTE=30
# MCP_MESSAGE_RATE_LIMIT_PER_MINUTE=120
# Comma-separated list of tool names allowed for Tier 3+ (destructive) operations in production.
# Empty or unset = deny all. Use '*' to allow all (not recommended).
# MCP_EXECUTE_TOOL_ALLOWLIST=run-script,restart-service

# --------------------------------------------
# WebRTC / Remote Desktop (TURN Server)
# --------------------------------------------
TURN_HOST=localhost
TURN_PORT=3478
TURN_SECRET=generate-a-random-secret-for-production
TURN_REALM=breeze.local

# --------------------------------------------
# File Transfer & Storage
# --------------------------------------------
TRANSFER_STORAGE_PATH=./data/transfers
MAX_TRANSFER_SIZE_MB=100
PATCH_REPORT_STORAGE_PATH=./data/patch-reports

# --------------------------------------------
# Monitoring & Metrics
# --------------------------------------------
METRICS_SCRAPE_TOKEN=generate-a-random-token-for-production

# --------------------------------------------
# Application URLs
# --------------------------------------------
# Used for links in emails and notifications
DASHBOARD_URL=http://localhost:4321
PUBLIC_APP_URL=http://localhost:4321

# --------------------------------------------
# Proxy Configuration
# --------------------------------------------
# Set to true if running behind a reverse proxy
TRUST_PROXY_HEADERS=false

# --------------------------------------------
# Logging & Monitoring
# --------------------------------------------
LOG_LEVEL=info
# Set to true for JSON structured logs
LOG_JSON=false

# --------------------------------------------
# Rate Limiting
# --------------------------------------------
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX_REQUESTS=100

# --------------------------------------------
# Session Configuration
# --------------------------------------------
SESSION_SECRET=another-secret-for-sessions-change-in-production
SESSION_MAX_AGE=86400000

# --------------------------------------------
# Feature Flags
# --------------------------------------------
ENABLE_REGISTRATION=true
ENABLE_2FA=true
ENABLE_API_DOCS=true

# --------------------------------------------
# Docker-specific (used in docker-compose)
# --------------------------------------------
# These override the above when running in Docker
# DOCKER_DATABASE_URL=postgresql://breeze:breeze@postgres:5432/breeze
# DOCKER_REDIS_URL=redis://redis:6379
